version: '3.4'

services:

  zoo-paris:
    build:
      context: ./zookeeper
      dockerfile: Dockerfile
    restart: always
    hostname: zoo-paris
    cap_add:
      - ALL
    container_name: zoo-paris
    networks:
      locknet:
        ipv4_address: 172.20.0.5
    ports:
      - 2181:2181
    environment:
      ZOO_MY_ID: 1
      ZOO_SERVERS: server.1=172.20.0.5:2888:3888;2181 server.4=zoo-capetown:2891:3891;2181 server.5=zoo-newyork:2892:3892;2181

  zoo-capetown:
    build:
      context: ./zookeeper
      dockerfile: Dockerfile
    restart: always
    hostname: zoo-capetown
    cap_add:
      - ALL
    container_name: zoo-capetown
    networks:
      locknet:
        ipv4_address: 172.20.0.8
    ports:
      - 2184:2181
    environment:
      ZOO_MY_ID: 4
      ZOO_SERVERS: server.1=zoo-paris:2888:3888;2181 server.4=172.20.0.8:2891:3891;2181 server.5=zoo-newyork:2892:3892;2181

  zoo-newyork:
    build:
      context: ./zookeeper
      dockerfile: Dockerfile
    restart: always
    hostname: zoo-newyork
    cap_add:
      - ALL
    container_name: zoo-newyork
    networks:
      locknet:
        ipv4_address: 172.20.0.9
    ports:
      - 2185:2181
    environment:
      ZOO_MY_ID: 5
      ZOO_SERVERS: server.1=zoo-paris:2888:3888;2181 server.4=zoo-capetown:2891:3891;2181 server.5=172.20.0.9:2892:3892;2181

  locker-paris:
    depends_on:
      - zoo-paris
    links:
      - zoo-paris

  locker-tokyo:
    depends_on:
      - zoo-newyork
    links:
      - zoo-newyork

  locker-singapore:
    depends_on:
      - zoo-paris
    links:
      - zoo-paris

  locker-capetown:
    depends_on:
      - zoo-capetown
    links:
      - zoo-capetown

  locker-newyork:
    depends_on:
      - zoo-newyork
    links:
      - zoo-newyork
